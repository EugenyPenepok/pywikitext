$(function() {
    function e(e) {
        return /^(GET|HEAD|OPTIONS|TRACE)$/.test(e)
    }
    var c = "";
    $("#btn-get-categories").on("click", function(e) {
        $.getJSON("get_categories", function(e) {
            c = e, t = n()
        })
    });
    var n = function() {
            return $("#treeview1").treeview({
                data: c,
                showIcon: !1,
                showCheckbox: !0,
                onNodeChecked: function(e, c) {
                    $("#checkable-output").prepend('<p> "' + c.text + '" выделена</p>')
                },
                onNodeUnchecked: function(e, c) {
                    $("#checkable-output").prepend('<p>"' + c.text + '" снято выделение</p>')
                }
            })
        },
        t = n(),
        i = function() {
            return t.treeview("search", [$("#input-check-node").val(), {
                ignoreCase: !1,
                exactMatch: !1
            }])
        },
        o = i();
    $("#input-check-node").on("keyup", function(e) {
        o = i(), $(".check-node").prop("disabled", !(o.length >= 1))
    }), $("#btn-check-node.check-node").on("click", function(e) {
        t.treeview("checkNode", [o, {
            silent: $("#chk-check-silent").is(":checked")
        }])
    }), $("#btn-uncheck-node.check-node").on("click", function(e) {
        t.treeview("uncheckNode", [o, {
            silent: $("#chk-check-silent").is(":checked")
        }])
    }), $("#btn-toggle-checked.check-node").on("click", function(e) {
        t.treeview("toggleNodeChecked", [o, {
            silent: $("#chk-check-silent").is(":checked")
        }])
    }), $("#btn-check-all").on("click", function(e) {
        t.treeview("checkAll", {
            silent: $("#chk-check-silent").is(":checked")
        })
    }), $("#btn-uncheck-all").on("click", function(e) {
        t.treeview("uncheckAll", {
            silent: $("#chk-check-silent").is(":checked")
        })
    });
    var k = jQuery("[name=csrfmiddlewaretoken]").val();
    $.ajaxSetup({
        beforeSend: function(c, n) {
            e(n.type) || this.crossDomain || c.setRequestHeader("X-CSRFToken", k)
        }
    }), $("#btn-accept").on("click", function(e) {
        for (var c = t.treeview("getChecked"), n = [], i = 0; i < c.length; i++) 
			n.push(c[i].href);
        $.ajax({
            type: "POST",
            url: "/post_tree_categories",
            data: {
                categories: JSON.stringify(n)
            }
        })
    })
});